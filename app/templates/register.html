<!DOCTYPE html>
<html lang="ar" dir="rtl" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ ÙÙŠ PneumoDetect - Ø§Ù†Ø¶Ù… Ø¥Ù„ÙŠÙ†Ø§ Ù„Ø¨Ø¯Ø¡ ØªØ­Ù„ÙŠÙ„ ØµÙˆØ±Ùƒ">
    <title data-i18n="register_title">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ - PneumoDetect</title>
    
    <!-- External Resources -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- CSS Unified System -->
    <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">
    
    <style>
        /* --- Global Variables & Theme --- */
        :root {
            --primary-color: #007a7a;
            --primary-hover: #005c5c;
            --tech-accent-color: #4361ee;
            --tech-accent-hover: #3a0ca3;
            --success-color: #28a745;
            --error-color: #dc3545;
            --warning-color: #ffc107;
            --light-color: #f8fafb;
            --light-section-bg: #f1f5f9;
            --dark-color: #2d3748;
            --white-color: #ffffff;
            --gray-color: #718096;
            --border-radius: 12px;
            --box-shadow: 0 10px 25px rgba(0, 0, 0, 0.07);
            --transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        [data-theme="dark"] {
            --primary-color: #00a8a8;
            --primary-hover: #008c8c;
            --tech-accent-color: #5a7fff;
            --tech-accent-hover: #4361ee;
            --light-color: #1a202c;
            --light-section-bg: #2d3748;
            --dark-color: #f7fafc;
            --white-color: #2d3748;
            --gray-color: #cbd5e0;
            --box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        [dir="ltr"] { font-family: 'Inter', sans-serif; }
        [dir="rtl"] { font-family: 'Tajawal', sans-serif; }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--light-color);
            color: var(--dark-color);
            line-height: 1.7;
            transition: var(--transition);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* --- Accessibility & Focus --- */
        a, button, input, [tabindex="0"] {
            outline: 2px solid transparent;
            outline-offset: 2px;
        }
        a:focus-visible, button:focus-visible, input:focus-visible, [tabindex="0"]:focus-visible {
            outline-color: var(--tech-accent-color);
            outline-offset: 3px;
        }

        /* --- Header --- */
        header {
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            position: sticky;
            top: 0;
            z-index: 1000;
            transition: var(--transition);
            min-height: 80px;
            display: flex;
            align-items: center;
            padding: 32px 40px 32px 40px;
        }

        .branding {
            display: flex;
            align-items: center;
            gap: 18px;
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--primary-color);
            position: absolute;
            right: 40px;
            height: 100%;
        }

        .header-actions { display: flex; align-items: center; gap: 20px; }
        .header-actions {
            display: flex;
            align-items: center;
            gap: 20px;
            position: absolute;
            left: 30px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--dark-color);
            text-decoration: none;
            font-weight: 500;
            padding: 8px 16px;
            border-radius: 50px;
            transition: var(--transition);
        }

        .nav-link:hover {
            background-color: var(--primary-color);
            color: var(--white-color);
        }

        .theme-toggle {
            background: none;
            border: none;
            color: var(--dark-color);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: var(--transition);
        }
        .theme-toggle:hover { background-color: rgba(0, 0, 0, 0.1); }

        .lang-toggle {
            position: relative;
            background-color: #e2e8f0;
            border-radius: 50px;
            padding: 4px;
            display: flex;
        }
        .lang-toggle button {
            background: none;
            border: none;
            padding: 8px 16px;
            cursor: pointer;
            font-weight: 600;
            color: var(--gray-color);
            border-radius: 50px;
            transition: color 0.3s;
            z-index: 2;
            position: relative;
        }
        .lang-toggle button.active { color: var(--white-color); }
        .lang-toggle .indicator {
            position: absolute;
            top: 4px;
            height: calc(100% - 8px);
            background-color: var(--primary-color);
            border-radius: 50px;
            transition: var(--transition);
            z-index: 1;
        }
        [dir="rtl"] .lang-toggle .indicator { right: 4px; width: calc(50% - 4px); }
        [dir="rtl"] .lang-toggle button[data-lang="en"].active ~ .indicator { transform: translateX(-100%); }
        [dir="ltr"] .lang-toggle .indicator { left: 4px; width: calc(50% - 4px); }
        [dir="ltr"] .lang-toggle button[data-lang="ar"].active ~ .indicator { transform: translateX(100%); }

        /* --- Main Layout --- */
        .register-container {
            flex-grow: 1;
            display: flex;
            background-color: var(--light-section-bg);
        }

        .welcome-section, .form-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 40px;
        }

        .welcome-section {
            background: linear-gradient(135deg, rgba(0, 122, 122, 0.9), rgba(0, 92, 92, 0.9)), 
                        url('/static/assets/images/register-bg.svg') center/cover;
            color: var(--white-color);
            text-align: center;
            gap: 30px;
        }

        .welcome-section h1 { font-size: 2.5rem; font-weight: 700; }
        .welcome-section p { font-size: 1.1rem; opacity: 0.9; max-width: 80%; margin: 0 auto; }
        
        .welcome-features { display: flex; flex-direction: column; gap: 20px; }
        .feature-item {
            display: flex;
            align-items: center;
            gap: 15px;
            text-align: right;
        }
        [dir="ltr"] .feature-item { text-align: left; }
        .feature-item i { font-size: 1.5rem; min-width: 30px; }

        /* --- Form Styling --- */
        .register-box {
            background-color: var(--white-color);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 40px;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
        }

        .register-box h2 { text-align: center; margin-bottom: 30px; color: var(--primary-color); }

        .form-group { margin-bottom: 20px; }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-color);
        }

        .input-wrapper { position: relative; }
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
            background-color: var(--white-color);
            color: var(--dark-color);
        }
        .form-control:focus {
            border-color: var(--tech-accent-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }
        .form-control.error { border-color: var(--error-color); }
        .form-control.success { border-color: var(--success-color); }

        .password-group { position: relative; }
        .password-group .form-control {
            padding-right: 45px;
        }
        [dir="ltr"] .password-group .form-control {
            padding-right: 15px;
            padding-left: 45px;
        }

        .password-toggle {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--gray-color);
            cursor: pointer;
            z-index: 2;
            padding: 5px;
            border-radius: 4px;
            transition: var(--transition);
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* RTL: Icon on right side of input field */
        [dir="rtl"] .password-toggle {
            right: 12px;
        }
        
        /* LTR: Icon on left side of input field */
        [dir="ltr"] .password-toggle {
            left: 12px;
        }
        
        .password-toggle:hover {
            color: var(--tech-accent-color);
            background-color: rgba(67, 97, 238, 0.1);
        }

        .error-text, .feedback-text {
            font-size: 0.85rem;
            margin-top: 5px;
            display: block;
        }
        .error-text { color: var(--error-color); }
        .feedback-text.success { color: var(--success-color); }
        .feedback-text.error { color: var(--error-color); }

        /* --- Radio & Checkbox Groups --- */
        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }
        .radio-option {
            flex: 1;
            position: relative;
        }
        .radio-option input[type="radio"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }
        .radio-label {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }
        .radio-option input[type="radio"]:checked + .radio-label {
            border-color: var(--primary-color);
            background-color: rgba(0, 122, 122, 0.1);
        }
        .radio-label i { font-size: 1.5rem; margin-bottom: 8px; }

        .checkbox-group {
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }
        .checkbox-group input[type="checkbox"] { margin-top: 4px; }

        /* --- Password Strength Meter --- */
        .password-requirements {
            background-color: var(--light-section-bg);
            padding: 15px;
            border-radius: var(--border-radius);
            margin-top: 10px;
        }
        .password-requirements ul { list-style: none; padding-left: 0; }
        .password-requirements li {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
        }
        .password-requirements li i { color: var(--error-color); }
        .password-requirements li.met i { color: var(--success-color); }

        .password-strength {
            margin-top: 10px;
        }
        .strength-bar {
            height: 5px;
            background-color: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
        }
        .strength-fill {
            height: 100%;
            width: 0;
            transition: width 0.3s ease;
        }
        .strength-fill.weak { width: 33%; background-color: var(--error-color); }
        .strength-fill.medium { width: 66%; background-color: var(--warning-color); }
        .strength-fill.strong { width: 100%; background-color: var(--success-color); }
        .strength-text {
            font-size: 0.85rem;
            margin-top: 5px;
            text-align: right;
        }
        [dir="ltr"] .strength-text { text-align: left; }

        /* --- Buttons --- */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 12px 28px;
            border-radius: var(--border-radius);
            font-weight: 600;
            text-decoration: none;
            border: none;
            cursor: pointer;
            transition: var(--transition);
            width: 100%;
            font-size: 1rem;
        }
        .btn-primary {
            background-color: var(--tech-accent-color);
            color: var(--white-color);
        }
        .btn-primary:hover {
            background-color: var(--tech-accent-hover);
            transform: translateY(-2px);
        }
        .btn:disabled { opacity: 0.7; cursor: not-allowed; }

        .loading-spinner {
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 2px solid white;
            width:16px;
            height: 16px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- Info & Error Boxes --- */
        .info-box {
            background-color: rgba(67, 97, 238, 0.1);
            border-left: 4px solid var(--tech-accent-color);
            padding: 15px;
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        .alert-error {
            background-color: rgba(220, 53, 69, 0.1);
            border-left: 4px solid var(--error-color);
            color: var(--error-color);
            padding: 15px;
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .login-link {
            text-align: center;
            margin-top: 20px;
            font-size: 0.9rem;
        }
        .login-link a {
            color: var(--tech-accent-color);
            text-decoration: none;
            font-weight: 600;
        }
        .login-link a:hover { text-decoration: underline; }

        /* --- Notification System --- */
        .notification-container {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .notification {
            background-color: var(--white-color);
            color: var(--dark-color);
            padding: 16px 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            display: flex;
            align-items: center;
            gap: 15px;
            min-width: 300px;
            border-right: 5px solid var(--tech-accent-color);
            animation: slideIn 0.3s ease-out;
        }
        .notification.error { border-right-color: var(--error-color); }
        .notification.success { border-right-color: var(--success-color); }
        .notification i { font-size: 1.5rem; }
        .notification.error i { color: var(--error-color); }
        .notification.success i { color: var(--success-color); }
        .notification-content { flex-grow: 1; }
        .notification-title { font-weight: 700; margin-bottom: 4px; }
        .notification-message { font-size: 0.9rem; color: var(--gray-color); }
        .notification-close { cursor: pointer; color: var(--gray-color); }
        @keyframes slideIn { from { transform: translateX(-120%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        /* --- Responsive Design --- */
        @media (max-width: 992px) {
            .register-container { flex-direction: column; }
            .welcome-section { padding: 60px 40px; }
            .form-section { padding: 40px 20px; }
        }
        @media (max-width: 576px) {
            .welcome-section h1 { font-size: 2rem; }
            .register-box { padding: 30px 20px; }
            .radio-group { flex-direction: column; }
        }
    </style>
</head>
<body role="application">
    <!-- Notification Container -->
    <div class="notification-container" id="notification-container"></div>

    <!-- Header -->
    <header role="banner">
        <div class="branding" style="position: absolute; right: 30px; left: auto; direction: ltr;">
            <i class="fas fa-lungs" aria-hidden="true"></i>
            <h1>PneumoDetect</h1>
        </div>
        <div class="header-actions" style="position: absolute; left: 30px; right: auto; flex-direction: row;">
            <a href="index.html" class="nav-link" aria-label="Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©">
                <i class="fas fa-home"></i>
                <span data-i18n="nav_home">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
            </a>
            <button class="theme-toggle" id="theme-toggle" aria-label="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ">
                <i class="fas fa-moon" id="theme-icon"></i>
            </button>
            <div class="lang-toggle" role="group" aria-label="ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ©">
                <button onclick="setLanguage('ar')" data-lang="ar" class="active" aria-pressed="true">AR</button>
                <button onclick="setLanguage('en')" data-lang="en" aria-pressed="false">EN</button>
                <div class="indicator"></div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main id="main-content" class="register-container" role="main">
        <!-- Welcome Section -->
        <section class="welcome-section" role="region" aria-labelledby="welcome-title">
            <h1 id="welcome-title" data-i18n="register_welcome_title">Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ PneumoDetect Ø§Ù„ÙŠÙˆÙ…</h1>
            <p data-i18n="register_welcome_subtitle">
                Ø£Ù†Ø´Ø¦ Ø­Ø³Ø§Ø¨Ùƒ Ø§Ù„Ø¢Ù† ÙˆØ§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ Ù†Ø­Ùˆ ØªØ´Ø®ÙŠØµØ§Øª Ø·Ø¨ÙŠØ© Ø£Ø³Ø±Ø¹ ÙˆØ£ÙƒØ«Ø± Ø¯Ù‚Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©.
            </p>
            
            <div class="welcome-features">
                <div class="feature-item">
                    <i class="fas fa-bolt"></i>
                    <div>
                        <strong data-i18n="home_card1_title">âš¡ ØªØ­Ù„ÙŠÙ„ ÙÙˆØ±ÙŠ</strong>
                        <p data-i18n="home_card1_desc">Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬ Ø¯Ù‚ÙŠÙ‚Ø© ÙÙŠ Ø«ÙˆØ§Ù†Ù Ù…Ø¹Ø¯Ù„Ø©.</p>
                    </div>
                </div>
                <div class="feature-item">
                    <i class="fas fa-user-md"></i>
                    <div>
                        <strong data-i18n="home_card2_title">âœ… Ù…Ø±Ø§Ø¬Ø¹Ø© Ù…ØªØ®ØµØµØ©</strong>
                        <p data-i18n="home_card2_desc">Ø§Ø·Ù„Ø¨ Ù…Ø±Ø§Ø¬Ø¹Ø© Ù…Ù† Ø£Ø·Ø¨Ø§Ø¡ Ù…Ø¹ØªÙ…Ø¯ÙŠÙ†.</p>
                    </div>
                </div>
                <div class="feature-item">
                    <i class="fas fa-shield-alt"></i>
                    <div>
                        <strong data-i18n="home_card3_title">ğŸ”’ Ø£Ù…Ø§Ù† Ø¹Ø§Ù„ÙŠ</strong>
                        <p data-i18n="home_card3_desc">Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù…Ø­Ù…ÙŠØ© Ø¨Ø£Ø¹Ù„Ù‰ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„ØªØ´ÙÙŠØ±.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Form Section -->
        <section class="form-section" role="region" aria-labelledby="form-title">
            <div class="register-box">
                <h2 id="form-title" data-i18n="register_title">ğŸ“ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
                
                <!-- Error Display Area -->
                <div id="register-error" class="alert-error" style="display: none;" role="alert" aria-live="assertive">
                    <i class="fas fa-exclamation-circle"></i>
                    <span id="error-message"></span>
                </div>

                <form id="register-form" novalidate role="form" aria-label="Ù†Ù…ÙˆØ°Ø¬ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯">
                    <!-- User Type Selection -->
                    <div class="form-group">
                        <label data-i18n="register_user_type_label">Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨</label>
                        <div class="radio-group" role="group" aria-label="Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨">
                            <div class="radio-option">
                                <input type="radio" id="patient" name="userType" value="patient" checked aria-label="Ø­Ø³Ø§Ø¨ Ù…Ø±ÙŠØ¶">
                                <label for="patient" class="radio-label">
                                    <i class="fas fa-user-injured" aria-hidden="true"></i>
                                    <span data-i18n="register_patient_option">Ù…Ø±ÙŠØ¶</span>
                                </label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="doctor" name="userType" value="doctor" aria-label="Ø­Ø³Ø§Ø¨ Ø·Ø¨ÙŠØ¨">
                                <label for="doctor" class="radio-label">
                                    <i class="fas fa-user-md" aria-hidden="true"></i>
                                    <span data-i18n="register_doctor_option">Ø·Ø¨ÙŠØ¨</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Doctor License Field (hidden by default) -->
                    <div class="form-group" id="doctor-license-group" style="display: none;">
                        <label for="doctor-license" data-i18n="register_license_label">Ø±Ù‚Ù… Ø§Ù„ØªØ±Ø®ÙŠØµ Ø§Ù„Ø·Ø¨ÙŠ</label>
                        <input 
                            type="text" 
                            id="doctor-license" 
                            name="license_number"
                            class="form-control"
                            data-i18n-placeholder="register_license_placeholder" 
                            placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… ØªØ±Ø®ÙŠØµÙƒ Ø§Ù„Ø·Ø¨ÙŠ"
                            aria-label="Ø±Ù‚Ù… Ø§Ù„ØªØ±Ø®ÙŠØµ Ø§Ù„Ø·Ø¨ÙŠ"
                            aria-describedby="license-error"
                        >
                        <span id="license-error" class="error-text" style="display: none;"></span>
                    </div>

                    <!-- Username -->
                    <div class="form-group">
                        <label for="register-username" data-i18n="register_username_label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                        <div class="input-wrapper">
                            <input 
                                type="text" 
                                id="register-username" 
                                name="username"
                                class="form-control"
                                data-i18n-placeholder="register_username_placeholder" 
                                placeholder="Ø§Ø®ØªØ± Ø§Ø³Ù… Ù…Ø³ØªØ®Ø¯Ù… ÙØ±ÙŠØ¯"
                                required
                                minlength="3"
                                maxlength="30"
                                pattern="^[a-zA-Z0-9_]+$"
                                aria-label="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…"
                                aria-describedby="username-error username-feedback"
                            >
                            <span id="username-feedback" class="feedback-text" style="display: none;"></span>
                        </div>
                        <span id="username-error" class="error-text" style="display: none;"></span>
                    </div>

                    <!-- Email -->
                    <div class="form-group">
                        <label for="register-email" data-i18n="register_email_label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                        <input 
                            type="email" 
                            id="register-email" 
                            name="email"
                            class="form-control"
                            data-i18n-placeholder="register_email_placeholder" 
                            placeholder="Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"
                            required
                            aria-label="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"
                            aria-describedby="email-error"
                        >
                        <span id="email-error" class="error-text" style="display: none;"></span>
                    </div>

                    <!-- Password -->
                    <div class="form-group">
                        <label for="register-password" data-i18n="register_password_label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <div class="password-group">
                            <input 
                                type="password" 
                                id="register-password" 
                                name="password"
                                class="form-control"
                                data-i18n-placeholder="register_password_placeholder" 
                                placeholder="Ø£Ù†Ø´Ø¦ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù‚ÙˆÙŠØ© (8 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)"
                                required
                                minlength="8"
                                maxlength="100"
                                aria-label="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"
                                aria-describedby="password-error password-requirements strength-text"
                            >
                            <button type="button" class="password-toggle" id="toggle-password" aria-label="Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" aria-pressed="false">
                                <i class="fas fa-eye" aria-hidden="true"></i>
                            </button>
                        </div>

                        <!-- Password Requirements -->
                        <div id="password-requirements" class="password-requirements" role="region" aria-label="Ù…ØªØ·Ù„Ø¨Ø§Øª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                            <p data-i18n="password_requirements_title">Ù…ØªØ·Ù„Ø¨Ø§Øª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</p>
                            <ul>
                                <li id="req-length"><i class="fas fa-times"></i> <span data-i18n="password_req_length">8 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„</span></li>
                                <li id="req-upper"><i class="fas fa-times"></i> <span data-i18n="password_req_upper">Ø­Ø±Ù ÙƒØ¨ÙŠØ± ÙˆØ§Ø­Ø¯ (A-Z)</span></li>
                                <li id="req-lower"><i class="fas fa-times"></i> <span data-i18n="password_req_lower">Ø­Ø±Ù ØµØºÙŠØ± ÙˆØ§Ø­Ø¯ (a-z)</span></li>
                                <li id="req-number"><i class="fas fa-times"></i> <span data-i18n="password_req_number">Ø±Ù‚Ù… ÙˆØ§Ø­Ø¯ (0-9)</span></li>
                            </ul>
                        </div>
                        
                        <!-- Password Strength Meter -->
                        <div class="password-strength">
                            <div class="strength-bar">
                                <div class="strength-fill" id="strength-fill"></div>
                            </div>
                            <div class="strength-text" id="strength-text" data-i18n="password_weak">Ø¶Ø¹ÙŠÙØ©</div>
                        </div>
                        <span id="password-error" class="error-text" style="display: none;"></span>
                    </div>

                    <!-- Confirm Password -->
                    <div class="form-group">
                        <label for="register-confirm" data-i18n="register_confirm_label">ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <input 
                            type="password" 
                            id="register-confirm" 
                            name="confirmPassword"
                            class="form-control"
                            data-i18n-placeholder="register_confirm_placeholder" 
                            placeholder="Ø£ÙƒØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"
                            required
                            minlength="8"
                            maxlength="100"
                            aria-label="ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"
                            aria-describedby="confirm-error"
                        >
                        <span id="confirm-error" class="error-text" style="display: none;"></span>
                    </div>

                    <!-- Terms & Conditions -->
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="agree-terms" required aria-label="Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø´Ø±ÙˆØ· Ø§Ù„Ø®Ø¯Ù…Ø© ÙˆØ³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©">
                            <label for="agree-terms" role="region" aria-label="Ø´Ø±ÙˆØ· Ø§Ù„Ø®Ø¯Ù…Ø©">
                                <span data-i18n="register_agree_terms">Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰</span> 
                                <a href="/terms" style="color: var(--tech-accent-color); text-decoration: none;" data-i18n="register_terms_link" aria-label="Ø§Ù‚Ø±Ø£ Ø´Ø±ÙˆØ· Ø§Ù„Ø®Ø¯Ù…Ø©">Ø´Ø±ÙˆØ· Ø§Ù„Ø®Ø¯Ù…Ø©</a> 
                                <span data-i18n="register_and">Ùˆ</span> 
                                <a href="/privacy" style="color: var(--tech-accent-color); text-decoration: none;" data-i18n="register_privacy_link" aria-label="Ø§Ù‚Ø±Ø£ Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</a>
                            </label>
                        </div>
                    </div>

                    <!-- Email Verification Notice -->
                    <div class="info-box" role="status">
                        <i class="fas fa-info-circle" aria-hidden="true"></i>
                        <p data-i18n="register_email_verification_notice">Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· ØªØ­Ù‚Ù‚ Ø¥Ù„Ù‰ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨</p>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" class="btn btn-primary" id="register-btn" aria-label="Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯">
                        <i class="fas fa-user-plus" aria-hidden="true"></i>
                        <span data-i18n="register_submit_btn">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</span>
                    </button>
                </form>

                <div class="login-link">
                    <span data-i18n="register_has_account">Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ</span>
                    <a href="login.html" data-i18n="register_login_link" aria-label="Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„">Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„</a>
                </div>
            </div>
        </section>
    </main>

    <script>
        // Translations
        const translations = {
            ar: {
                nav_home: "Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©",
                register_welcome_title: "Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ PneumoDetect Ø§Ù„ÙŠÙˆÙ…",
                register_welcome_subtitle: "Ø£Ù†Ø´Ø¦ Ø­Ø³Ø§Ø¨Ùƒ Ø§Ù„Ø¢Ù† ÙˆØ§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ Ù†Ø­Ùˆ ØªØ´Ø®ÙŠØµØ§Øª Ø·Ø¨ÙŠØ© Ø£Ø³Ø±Ø¹ ÙˆØ£ÙƒØ«Ø± Ø¯Ù‚Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©.",
                home_card1_title: "âš¡ ØªØ­Ù„ÙŠÙ„ ÙÙˆØ±ÙŠ", home_card1_desc: "Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬ Ø¯Ù‚ÙŠÙ‚Ø© ÙÙŠ Ø«ÙˆØ§Ù†Ù Ù…Ø¹Ø¯Ù„Ø©.",
                home_card2_title: "âœ… Ù…Ø±Ø§Ø¬Ø¹Ø© Ù…ØªØ®ØµØµØ©", home_card2_desc: "Ø§Ø·Ù„Ø¨ Ù…Ø±Ø§Ø¬Ø¹Ø© Ù…Ù† Ø£Ø·Ø¨Ø§Ø¡ Ù…Ø¹ØªÙ…Ø¯ÙŠÙ†.",
                home_card3_title: "ğŸ”’ Ø£Ù…Ø§Ù† Ø¹Ø§Ù„ÙŠ", home_card3_desc: "Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù…Ø­Ù…ÙŠØ© Ø¨Ø£Ø¹Ù„Ù‰ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„ØªØ´ÙÙŠØ±.",
                register_title: "ğŸ“ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯",
                register_user_type_label: "Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨",
                register_patient_option: "Ù…Ø±ÙŠØ¶",
                register_doctor_option: "Ø·Ø¨ÙŠØ¨",
                register_license_label: "Ø±Ù‚Ù… Ø§Ù„ØªØ±Ø®ÙŠØµ Ø§Ù„Ø·Ø¨ÙŠ",
                register_license_placeholder: "Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… ØªØ±Ø®ÙŠØµÙƒ Ø§Ù„Ø·Ø¨ÙŠ",
                register_username_label: "Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…",
                register_username_placeholder: "Ø§Ø®ØªØ± Ø§Ø³Ù… Ù…Ø³ØªØ®Ø¯Ù… ÙØ±ÙŠØ¯",
                register_email_label: "Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ",
                register_email_placeholder: "Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ",
                register_password_label: "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±",
                register_password_placeholder: "Ø£Ù†Ø´Ø¦ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù‚ÙˆÙŠØ© (8 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)",
                password_requirements_title: "Ù…ØªØ·Ù„Ø¨Ø§Øª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:",
                password_req_length: "8 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„",
                password_req_upper: "Ø­Ø±Ù ÙƒØ¨ÙŠØ± ÙˆØ§Ø­Ø¯ (A-Z)",
                password_req_lower: "Ø­Ø±Ù ØµØºÙŠØ± ÙˆØ§Ø­Ø¯ (a-z)",
                password_req_number: "Ø±Ù‚Ù… ÙˆØ§Ø­Ø¯ (0-9)",
                password_weak: "Ø¶Ø¹ÙŠÙØ©",
                password_medium: "Ù…ØªÙˆØ³Ø·Ø©",
                password_strong: "Ù‚ÙˆÙŠØ©",
                register_confirm_label: "ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±",
                register_confirm_placeholder: "Ø£ÙƒØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±",
                register_agree_terms: "Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰",
                register_terms_link: "Ø´Ø±ÙˆØ· Ø§Ù„Ø®Ø¯Ù…Ø©",
                register_and: "Ùˆ",
                register_privacy_link: "Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©",
                register_email_verification_notice: "Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· ØªØ­Ù‚Ù‚ Ø¥Ù„Ù‰ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨",
                register_submit_btn: "Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨",
                register_has_account: "Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ",
                register_login_link: "Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„",
                error_username_taken: "Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ø§ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„.",
                error_email_taken: "Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù‡Ø°Ø§ Ù…Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙØ¹Ù„.",
                error_password_mismatch: "ÙƒÙ„Ù…ØªØ§ Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚ØªÙŠÙ†.",
                register_success: "ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­! ÙŠØ±Ø¬Ù‰ ÙØ­Øµ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨.",
                register_error: "ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰."
            },
            en: {
                nav_home: "Home",
                register_welcome_title: "Join PneumoDetect Today",
                register_welcome_subtitle: "Create your account now and start your journey towards faster and more accurate medical diagnoses using advanced AI technologies.",
                home_card1_title: "âš¡ Instant Analysis", home_card1_desc: "Get accurate results in seconds.",
                home_card2_title: "âœ… Specialized Review", home_card2_desc: "Request a review from certified doctors.",
                home_card3_title: "ğŸ”’ High Security", home_card3_desc: "Your data is protected with highest encryption standards.",
                register_title: "ğŸ“ Create New Account",
                register_user_type_label: "Account Type",
                register_patient_option: "Patient",
                register_doctor_option: "Doctor",
                register_license_label: "Medical License Number",
                register_license_placeholder: "Enter your medical license number",
                register_username_label: "Username",
                register_username_placeholder: "Choose a unique username",
                register_email_label: "Email",
                register_email_placeholder: "Enter your email address",
                register_password_label: "Password",
                register_password_placeholder: "Create a strong password (at least 8 characters)",
                password_requirements_title: "Password Requirements:",
                password_req_length: "At least 8 characters",
                password_req_upper: "One uppercase letter (A-Z)",
                password_req_lower: "One lowercase letter (a-z)",
                password_req_number: "One number (0-9)",
                password_weak: "Weak",
                password_medium: "Medium",
                password_strong: "Strong",
                register_confirm_label: "Confirm Password",
                register_confirm_placeholder: "Confirm your password",
                register_agree_terms: "I agree to",
                register_terms_link: "Terms of Service",
                register_and: "and",
                register_privacy_link: "Privacy Policy",
                register_email_verification_notice: "A verification link will be sent to your email to activate account",
                register_submit_btn: "Create Account",
                register_has_account: "Already have an account?",
                register_login_link: "Log in",
                error_username_taken: "This username is already taken.",
                error_email_taken: "This email is already registered.",
                error_password_mismatch: "Passwords do not match.",
                register_success: "Account created successfully! Please check your email to activate your account.",
                register_error: "Failed to create account. Please try again."
            }
        };

        const appState = { 
            currentLang: 'ar',
            isDarkMode: false
        };

        document.addEventListener('DOMContentLoaded', () => {
            const savedLang = localStorage.getItem('pneumoDetectLang') || 'ar';
            const savedTheme = localStorage.getItem('pneumoDetectTheme') || 'light';
            
            setLanguage(savedLang);
            setTheme(savedTheme);
            setupEventListeners();
        });

        function setLanguage(lang) {
            appState.currentLang = lang;
            localStorage.setItem('pneumoDetectLang', lang);
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
            
            document.querySelectorAll('.lang-toggle button').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('data-lang') === lang);
                btn.setAttribute('aria-pressed', btn.getAttribute('data-lang') === lang ? 'true' : 'false');
            });
            
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (translations[lang] && translations[lang][key]) {
                    element.textContent = translations[lang][key];
                }
            });

            document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
                const key = element.getAttribute('data-i18n-placeholder');
                if (translations[lang] && translations[lang][key]) {
                    element.placeholder = translations[lang][key];
                }
            });
        }

        function setTheme(theme) {
            appState.isDarkMode = theme === 'dark';
            localStorage.setItem('pneumoDetectTheme', theme);
            document.documentElement.setAttribute('data-theme', theme);
            
            const themeIcon = document.getElementById('theme-icon');
            themeIcon.className = appState.isDarkMode ? 'fas fa-sun' : 'fas fa-moon';
            
            const themeToggle = document.getElementById('theme-toggle');
            themeToggle.setAttribute('aria-label', appState.isDarkMode ? 'Switch to light mode' : 'Switch to dark mode');
        }

        function toggleTheme() {
            setTheme(appState.isDarkMode ? 'light' : 'dark');
        }

        function showNotification(message, type = 'info', title = '') {
            const container = document.getElementById('notification-container');
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            const icon = type === 'error' ? 'fa-exclamation-circle' : (type === 'success' ? 'fa-check-circle' : 'fa-info-circle');
            
            notification.innerHTML = `
                <i class="fas ${icon}"></i>
                <div class="notification-content">
                    ${title ? `<div class="notification-title">${title}</div>` : ''}
                    <div class="notification-message">${message}</div>
                </div>
                <i class="fas fa-times notification-close" onclick="this.parentElement.remove()"></i>
            `;
            
            container.appendChild(notification);
            setTimeout(() => notification.remove(), 5000);
        }

        function setupEventListeners() {
            const form = document.getElementById('register-form');
            const passwordInput = document.getElementById('register-password');
            const confirmInput = document.getElementById('register-confirm');
            const toggleBtn = document.getElementById('toggle-password');
            const registerBtn = document.getElementById('register-btn');
            const userTypeRadios = document.querySelectorAll('input[name="userType"]');
            const doctorLicenseGroup = document.getElementById('doctor-license-group');
            const themeToggle = document.getElementById('theme-toggle');

            // Theme toggle
            themeToggle.addEventListener('click', toggleTheme);

            // User type selection
            userTypeRadios.forEach(radio => {
                radio.addEventListener('change', () => {
                    if (radio.value === 'doctor') {
                        doctorLicenseGroup.style.display = 'block';
                    } else {
                        doctorLicenseGroup.style.display = 'none';
                    }
                });
            });

            // Password visibility toggle
            toggleBtn?.addEventListener('click', () => {
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);
                toggleBtn.innerHTML = type === 'password' 
                    ? '<i class="fas fa-eye"></i>' 
                    : '<i class="fas fa-eye-slash"></i>';
                toggleBtn.setAttribute('aria-pressed', type === 'text');
            });

            // Real-time password strength checker
            passwordInput.addEventListener('input', () => {
                const password = passwordInput.value;
                let strength = 0;
                
                // Check requirements
                const reqLength = document.getElementById('req-length');
                const reqUpper = document.getElementById('req-upper');
                const reqLower = document.getElementById('req-lower');
                const reqNumber = document.getElementById('req-number');
                
                if (password.length >= 8) {
                    strength++;
                    reqLength.classList.add('met');
                    reqLength.querySelector('i').className = 'fas fa-check';
                } else {
                    reqLength.classList.remove('met');
                    reqLength.querySelector('i').className = 'fas fa-times';
                }
                
                if (/[A-Z]/.test(password)) {
                    strength++;
                    reqUpper.classList.add('met');
                    reqUpper.querySelector('i').className = 'fas fa-check';
                } else {
                    reqUpper.classList.remove('met');
                    reqUpper.querySelector('i').className = 'fas fa-times';
                }
                
                if (/[a-z]/.test(password)) {
                    strength++;
                    reqLower.classList.add('met');
                    reqLower.querySelector('i').className = 'fas fa-check';
                } else {
                    reqLower.classList.remove('met');
                    reqLower.querySelector('i').className = 'fas fa-times';
                }
                
                if (/[0-9]/.test(password)) {
                    strength++;
                    reqNumber.classList.add('met');
                    reqNumber.querySelector('i').className = 'fas fa-check';
                } else {
                    reqNumber.classList.remove('met');
                    reqNumber.querySelector('i').className = 'fas fa-times';
                }

                // Update strength meter
                const strengthFill = document.getElementById('strength-fill');
                const strengthText = document.getElementById('strength-text');

                strengthFill.className = 'strength-fill'; // Reset classes
                
                if (strength <= 1) {
                    strengthFill.classList.add('weak');
                    strengthText.textContent = t('password_weak');
                } else if (strength === 2) {
                    strengthFill.classList.add('medium');
                    strengthText.textContent = t('password_medium');
                } else if (strength === 3) {
                    strengthFill.classList.add('medium');
                    strengthText.textContent = t('password_medium');
                } else {
                    strengthFill.classList.add('strong');
                    strengthText.textContent = t('password_strong');
                }
                
                checkPasswordMatch(); // Re-check match on password change
            });

            // Check if passwords match
            function checkPasswordMatch() {
                const match = passwordInput.value === confirmInput.value && passwordInput.value.length > 0;
                confirmInput.style.borderColor = match ? 'var(--success-color)' : 'var(--error-color)';
                
                const confirmError = document.getElementById('confirm-error');
                if (confirmInput.value.length > 0 && !match) {
                    confirmError.textContent = t('error_password_mismatch');
                    confirmError.style.display = 'block';
                } else {
                    confirmError.style.display = 'none';
                }
            }
            
            confirmInput.addEventListener('input', checkPasswordMatch);

            // Form submission
            form.addEventListener('submit', async (e) => {
                e.preventDefault();

                if (passwordInput.value !== confirmInput.value) {
                    showNotification(t('error_password_mismatch'), 'error');
                    return;
                }

                const userType = document.querySelector('input[name="userType"]:checked').value;
                const formData = new FormData(form);
                const data = Object.fromEntries(formData.entries());
                data.userType = userType; // Add userType to data object
                // Make sure we have all required fields
                if (!data.username || !data.email || !data.password) {
                    showNotification(t('register_error') || 'Please fill all required fields', 'error');
                    registerBtn.disabled = false;
                    registerBtn.innerHTML = '<i class="fas fa-user-plus"></i> ' + t('register_submit_btn');
                    return;
                }

                registerBtn.disabled = true;
                registerBtn.innerHTML = '<span class="loading-spinner"></span> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...';

                // Real API call to /api/auth/register
                try {
                    const response = await fetch('/api/auth/register', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRF-Token': getCsrfToken()
                        },
                        credentials: 'include',
                        body: JSON.stringify(data)
                    });

                    const result = await response.json();

                    if (result.success) {
                        showNotification(t('register_success'), 'success');
                        form.reset();
                        setTimeout(() => window.location.href = '/login.html', 1500);
                    } else {
                        showNotification(result.message || t('register_error'), 'error');
                        registerBtn.disabled = false;
                        registerBtn.innerHTML = '<i class="fas fa-user-plus"></i> <span data-i18n="register_submit_btn">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</span>';
                        setLanguage(appState.currentLang);
                    }
                } catch (error) {
                    console.error('Registration error:', error);
                    showNotification(t('error_network'), 'error');
                    registerBtn.disabled = false;
                    registerBtn.innerHTML = '<i class="fas fa-user-plus"></i> <span data-i18n="register_submit_btn">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</span>';
                    setLanguage(appState.currentLang);
                }
            });

            // Helper function to get CSRF token from cookie
            function getCsrfToken() {
                const name = 'XSRF-TOKEN=';
                const decodedCookie = decodeURIComponent(document.cookie);
                const cookieArray = decodedCookie.split(';');
                for (let i = 0; i < cookieArray.length; i++) {
                    let cookie = cookieArray[i].trim();
                    if (cookie.indexOf(name) === 0) {
                        return cookie.substring(name.length);
                    }
                }
                return '';
            }
        }
        
        function t(key) { return translations[appState.currentLang][key] || key; }
    </script>
    <!-- Core JavaScript Module -->
    <script src="{{ url_for('static', filename='core.js') }}"></script>
    <script>
        // Initialize PneumoApp on page load
        document.addEventListener('DOMContentLoaded', () => {
            if (window.PneumoApp) {
                PneumoApp.init();
                PneumoApp.Theme.init();
            }
        });
    </script>
</body>
</html>